<!DOCTYPE html> <!-- Document type declaration -->
<html lang="en"> <!-- Set document language to English -->
<head>
  <meta charset="UTF-8"> <!-- Character encoding -->
  <title>Solar Panels Prediction</title> <!-- Browser tab title -->
  <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Responsive meta -->

  <!-- Minimal CSS framework + font for nicer typography -->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> <!-- Optional utility CSS -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"> <!-- Google Font -->

  <style>
  /* ====== Global styles ====== */
  body {
    font-family: 'Poppins', sans-serif; /* Use Poppins font */
    margin: 0;                          /* Remove default margin */
    background-color: white;            /* White background */
    color: #222;                        /* Base text color */
  }

  /* ====== First screen (landing) ====== */
  #landing {
    position: relative;                                 /* Position children absolutely inside */
    height: 100vh;                                      /* Full viewport height */
    background: url("/static/images/solarpanels.webp")  /* Background image */
                center/cover no-repeat;                 /* Center & cover */
  }

  #landing .logo {
    position: absolute; /* Place logo over background */
    top: 20px;
    right: 20px;
    width: 110px;       /* Fixed logo size */
  }

  .info-box {
    position: absolute;                       /* Floating info card */
    bottom: 60px;
    left: 60px;
    background: rgba(255, 255, 255, 0.9);     /* White with transparency */
    border-radius: 10px;                      /* Rounded corners */
    padding: 25px 30px;                       /* Inner spacing */
    max-width: 420px;                         /* Limit width */
  }

  .start-btn {
    background: white;        /* Button background */
    border: none;             /* No border */
    font-size: 16px;
    padding: 10px 20px;
    border-radius: 8px;       /* Rounded corners */
    cursor: pointer;          /* Pointer on hover */
    transition: 0.3s;         /* Smooth hover transition */
    font-weight: 500;
  }

  .start-btn:hover { background: #f1f1f1; } /* Subtle hover */

  /* ====== Second screen (prediction) ====== */
  #prediction {
    display: none;         /* Hidden by default; shown via JS */
    background: white;
    min-height: 100vh;
  }

  .top-half {
    position: relative;                                 /* For absolute children */
    height: 50vh;                                       /* Top half height */
    background: url("/static/images/solarpanels.webp")  /* Hero image reused */
                center/cover no-repeat;
  }

  .top-half .logo {
    position: absolute; /* Position logo inside top-half */
    top: 20px;
    right: 20px;
    width: 110px;
  }

  .bottom-half {
    background-color: white;
    text-align: center; /* Center heading and options */
    padding: 60px 40px;
  }

  .divider {
    width: 90%;
    height: 1px;
    background-color: #ccc; /* Light separator line */
    margin: 50px auto;
  }

  .main-title {
    font-size: 40px;    /* Big headline */
    font-weight: 600;
    margin-bottom: 40px;
    color: #000;
  }

  .option-btn {
    border: none;       /* Clean button */
    background: none;
    cursor: pointer;
    margin: 0 40px;     /* Spacing between options */
    transition: 0.3s;
  }

  .option-btn img {
    width: 130px;       /* Icon tile */
    height: 130px;
    border-radius: 15px;
  }

  .option-btn:hover { transform: scale(1.05); } /* Slight pop */
  .option-btn p { font-weight: bold; font-size: 20px; margin-top: 10px; }

  /* ====== Prediction form section ====== */
  #form-section {
    display: none;         /* Hidden until user clicks Predict */
    margin-top: 40px;
    text-align: left;      /* Align labels/inputs left */
    width: 60%;            /* Narrow width for readability */
    margin-left: 80px;
  }

  label {
    display: block;        /* One label per line */
    font-size: 16px;
    margin-bottom: 6px;
    font-weight: 500;
  }

  input {
    width: 100%;           /* Full-width inputs */
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #aaa;
    border-radius: 6px;
    font-size: 15px;
  }

  .result-btn {
    background-color: #155d27; /* Primary action color (green) */
    color: white;
    border: none;
    width: 100%;
    padding: 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 18px;
    font-weight: 600;
    margin-top: 15px;
    transition: 0.3s ease;
  }

  .result-btn:hover { background-color: #0e441c; } /* Darker on hover */

  .result {
    margin-top: 35px;
    font-size: 26px;
    font-weight: bold;
    color: #000;
    display: none; /* Reveal after prediction returns */
  }

  .result span {
    color: #155d27;  /* Highlight predicted value */
    font-size: 28px;
  }

  .back-btn {
    position: absolute;                    /* Back button on top image */
    top: 25px;
    left: 25px;
    background-color: rgba(255,255,255,0.8);
    color: #000;
    padding: 8px 18px;
    border-radius: 6px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: 0.3s;
  }

  .back-btn:hover { background-color: rgba(255,255,255,1); }
  </style>
</head>

<body>
  <!-- ====== Landing screen ====== -->
  <div id="landing"> <!-- Full-screen hero section -->
    <img src="/static/images/logo.png" class="logo" alt="Logo"> <!-- Top-right logo -->
    <div class="info-box"> <!-- Intro card with title and CTA -->
      <h2>Solar Panels of King Khalid's University</h2> <!-- Project title -->
      <p>Solar energy is one of King Khalid's University leading renewable initiatives, contributing to Saudi Arabia’s Vision 2030.</p> <!-- Short intro -->
      <button class="start-btn" onclick="goToPrediction()">Start</button> <!-- Navigate to prediction view -->
    </div>
  </div>

  <!-- ====== Prediction screen ====== -->
  <div id="prediction"> <!-- Hidden until Start -->
    <div class="top-half"> <!-- Hero image header -->
      <img src="/static/images/logo.png" class="logo" alt="Logo"> <!-- Logo on header -->
      <button class="back-btn" onclick="goToLanding()">← Back</button> <!-- Back to landing -->
    </div>

    <div class="bottom-half"> <!-- Content area -->
      <h1 class="main-title">Solar Panels Of King Khalid University</h1> <!-- Main heading -->

      <!-- Action options -->
      <div>
        <button class="option-btn" onclick="showPredictForm()"> <!-- Show the prediction form -->
          <img src="/static/images/predict.png" alt="Predict">
          <p>Predict</p>
        </button>

        <button class="option-btn" onclick="showForecast()"> <!-- Placeholder for future feature -->
          <img src="/static/images/forecast.png" alt="Forecast">
          <p>Forecast</p>
        </button>
      </div>

      <!-- Prediction form -->
      <div id="form-section">
        <div class="divider"></div> <!-- Visual separator -->

        <form id="predict-form"> <!-- Form sent to FastAPI /predict -->
          {% for i in range(1, 11) %} <!-- Loop through 10 input fields -->
          <label>{{ [
            'Total_Solar_Irradiance_on_Inclined_Plane_POA1_W_m2',
            'Total_Solar_Irradiance_on_Horizontal_Plane_GHI_W_m2',
            'Module_Surface_Temperature1_degree_centigrade',
            'Temperature_Reference_CellDeg_C',
            'Module_Surface_Temperature2_degree_centigrade',
            'Temperature_TestDeg_C',
            'Geff_ReferenceW_M2',
            'Geff_TestW_M2',
            'Ambient_Temp._degree_centigrade',
            'Relative_Humidity_%'
          ][i-1] }}:</label> <!-- Label text from a static list -->
          <input type="text" name="feature{{i}}" value="{{ values['feature' ~ i] if values else '' }}" required> <!-- Numeric input -->
          {% endfor %}

          <button type="submit" class="result-btn">Result</button> <!-- Submit form -->
        </form>

        <h2 id="result-box" class="result"> <!-- Prediction result container -->
          Predicted Active Power: <span id="result-value"></span> <!-- Value filled by JS -->
        </h2>
      </div>
    </div>
  </div>

<script>
/* ====== View switches between landing and prediction ====== */
function goToPrediction() {
  document.getElementById("landing").style.display = "none";   // Hide landing
  document.getElementById("prediction").style.display = "block"; // Show prediction
}

function goToLanding() {
  document.getElementById("prediction").style.display = "none"; // Hide prediction
  document.getElementById("landing").style.display = "block";   // Show landing
}

/* ====== Reveal the prediction form and scroll to it ====== */
function showPredictForm() {
  document.getElementById("form-section").style.display = "block"; // Show form
  document.getElementById("form-section").scrollIntoView({ behavior: "smooth", block: "center" }); // Smooth scroll
}

/* ====== Placeholder for future Forecast feature ====== */
function showForecast() {
  alert("Forecast feature coming soon!"); // Temporary alert
}

/* ====== Input sanitization: allow only digits, dot, comma, minus ====== */
document.querySelectorAll('#predict-form input').forEach(input => {
  input.addEventListener("input", function () {
    this.value = this.value.replace(/[^0-9.,-]/g, ""); // Strip invalid characters
  });
});

/* ====== Submit form via Fetch to FastAPI /predict (AJAX) ====== */
document.getElementById("predict-form").addEventListener("submit", async function (e) {
  e.preventDefault(); // Prevent full page reload

  const form = e.target;
  const btn = form.querySelector(".result-btn");
  const resultBox = document.getElementById("result-box");
  const resultValue = document.getElementById("result-value");

  // Normalize commas to dots to ensure parseable floats on the backend
  form.querySelectorAll("input").forEach(inp => {
    inp.value = inp.value.replace(/,/g, ".");
  });

  const formData = new FormData(form); // Collect form fields

  const oldText = btn.textContent; // Keep original button text
  btn.disabled = true;             // Disable during request
  btn.textContent = "Calculating..."; // Loading state

  try {
    const res = await fetch("/predict", { method: "POST", body: formData }); // POST to FastAPI
    const data = await res.json();                                          // Parse JSON

    resultValue.textContent = data.result; // Show predicted value
    resultBox.style.display = "block";     // Reveal result box

    resultBox.scrollIntoView({ behavior: "smooth", block: "center" }); // Scroll to result
  } catch {
    alert("Error occurred. Please try again."); // Basic error handler
  } finally {
    btn.disabled = false;        // Re-enable button
    btn.textContent = oldText;   // Restore label
  }
});
</script>
</body>
</html>
